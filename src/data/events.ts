import { TicketPolicy } from '@/types/ticketing';
import { canonicalizePolicy, derivePolicySignature } from '@/lib/ticketing';

export type EventRecord = {
  eventId: string;
  name: string;
  venue?: string;
  startsAtISO: string;
  endsAtISO: string;
  capacity: number;
  priceSats: number;
  protocolAddr: string;
  venueSink: string;
  salesOpen: boolean;
  sold: number;
  redeemed: number;
  revenueSats: number;
  policy: TicketPolicy;
  policyJson: string;
  issuerSignature?: string;
  imageUrl?: string;
};

const buildEventRecord = (config: Omit<EventRecord, 'policyJson' | 'issuerSignature'> & { issuerSignatureSeed?: string }) => {
  const policyJson = canonicalizePolicy(config.policy);
  const issuerSignature = derivePolicySignature(config.eventId, config.issuerSignatureSeed ?? 'template', policyJson);

  return {
    ...config,
    policyJson,
    issuerSignature,
  } satisfies EventRecord;
};

const demoPolicyA: TicketPolicy = {
  resaleAllowed: true,
  royaltyBps: 750,
  royaltyRecipients: [
    { id: 'organizer', lockingScriptHex: '76a914c1a5cafe88ac', bps: 6000 },
    { id: 'artist', lockingScriptHex: '76a914f00dbabe88ac', bps: 4000 },
  ],
  primaryRecipients: [
    { id: 'organizer', lockingScriptHex: '76a914c1a5cafe88ac', bps: 5000 },
    { id: 'venue', lockingScriptHex: '76a914deadbeef88ac', bps: 3000 },
    { id: 'protocol', lockingScriptHex: '76a914feedface88ac', bps: 2000 },
  ],
  version: '1',
  issuerId: 'btc_conf_issuer',
};

const demoPolicyB: TicketPolicy = {
  resaleAllowed: false,
  royaltyBps: 0,
  royaltyRecipients: [
    { id: 'issuer', lockingScriptHex: '76a914facefeed88ac', bps: 10000 },
  ],
  primaryRecipients: [
    { id: 'workshop', lockingScriptHex: '76a914f00dbabe88ac', bps: 7000 },
    { id: 'venue', lockingScriptHex: '76a914deadbeef88ac', bps: 3000 },
  ],
  version: '1',
  issuerId: 'ln_workshop_org',
};

const demoPolicyC: TicketPolicy = {
  resaleAllowed: true,
  royaltyBps: 500,
  royaltyRecipients: [
    { id: 'curator', lockingScriptHex: '76a9141234567890abcdef1234567890abcdef88ac', bps: 5000 },
    { id: 'venue', lockingScriptHex: '76a914fedcba9876543210fedcba9876543210888ac', bps: 5000 },
  ],
  primaryRecipients: [
    { id: 'organizer', lockingScriptHex: '76a914abcdefabcdefabcdefabcdefabcdefabcd88ac', bps: 6000 },
    { id: 'artist', lockingScriptHex: '76a914bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb88ac', bps: 2000 },
    { id: 'protocol', lockingScriptHex: '76a914cccccccccccccccccccccccccccccccc88ac', bps: 2000 },
  ],
  version: '1',
  issuerId: 'night_market_collective',
};

const demoPolicyD: TicketPolicy = {
  resaleAllowed: true,
  royaltyBps: 850,
  royaltyRecipients: [
    { id: 'organizer', lockingScriptHex: '76a914d1d1d1d1d1d1d1d1d1d1d1d1d1d1d1d188ac', bps: 5000 },
    { id: 'foundation', lockingScriptHex: '76a914e2e2e2e2e2e2e2e2e2e2e2e2e2e2e2e288ac', bps: 5000 },
  ],
  primaryRecipients: [
    { id: 'organizer', lockingScriptHex: '76a914f3f3f3f3f3f3f3f3f3f3f3f3f3f3f3f388ac', bps: 4000 },
    { id: 'venue', lockingScriptHex: '76a914a4a4a4a4a4a4a4a4a4a4a4a4a4a4a4a488ac', bps: 3000 },
    { id: 'artist', lockingScriptHex: '76a914b5b5b5b5b5b5b5b5b5b5b5b5b5b5b5b588ac', bps: 2000 },
    { id: 'protocol', lockingScriptHex: '76a914c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c688ac', bps: 1000 },
  ],
  version: '1',
  issuerId: 'midnight_assembly',
};

const demoPolicyE: TicketPolicy = {
  resaleAllowed: true,
  royaltyBps: 300,
  royaltyRecipients: [
    { id: 'collective', lockingScriptHex: '76a9141122aabbccddeeff1122aabbccddeeff112288ac', bps: 7000 },
    { id: 'venue', lockingScriptHex: '76a91433445566778899aabbccddeeff001122334488ac', bps: 3000 },
  ],
  primaryRecipients: [
    { id: 'organizer', lockingScriptHex: '76a9145566778899aabbccddeeff0011223344556688ac', bps: 4000 },
    { id: 'venue', lockingScriptHex: '76a91477889900aabbccddeeff001122334455667788ac', bps: 3500 },
    { id: 'production', lockingScriptHex: '76a91499aabbccddeeff00112233445566778899aabb88ac', bps: 2000 },
    { id: 'protocol', lockingScriptHex: '76a914bbaaccddeeff00112233445566778899aabbcc88ac', bps: 500 },
  ],
  version: '1',
  issuerId: 'sat_sessions_co',
};

const demoPolicyF: TicketPolicy = {
  resaleAllowed: false,
  royaltyBps: 0,
  royaltyRecipients: [
    { id: 'issuer', lockingScriptHex: '76a9140f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f88ac', bps: 10000 },
  ],
  primaryRecipients: [
    { id: 'organizer', lockingScriptHex: '76a9141a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a88ac', bps: 6500 },
    { id: 'venue', lockingScriptHex: '76a9142b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b88ac', bps: 2500 },
    { id: 'protocol', lockingScriptHex: '76a9143c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c88ac', bps: 1000 },
  ],
  version: '1',
  issuerId: 'bazaar_collective',
};

const demoPolicyG: TicketPolicy = {
  resaleAllowed: true,
  royaltyBps: 950,
  royaltyRecipients: [
    { id: 'organizer', lockingScriptHex: '76a9144142434445464748494a4b4c4d4e4f505188ac', bps: 4000 },
    { id: 'foundation', lockingScriptHex: '76a9145152535455565758595a5b5c5d5e5f60616288ac', bps: 3500 },
    { id: 'protocol', lockingScriptHex: '76a914636465666768696a6b6c6d6e6f707172737488ac', bps: 2500 },
  ],
  primaryRecipients: [
    { id: 'organizer', lockingScriptHex: '76a9147475767778797a7b7c7d7e7f808182838488ac', bps: 4500 },
    { id: 'venue', lockingScriptHex: '76a91485868788898a8b8c8d8e8f90919293949588ac', bps: 3200 },
    { id: 'artist', lockingScriptHex: '76a914969798999a9b9c9d9e9fa0a1a2a3a4a5a688ac', bps: 2000 },
    { id: 'protocol', lockingScriptHex: '76a914a7a8a9aaabacadaeafb0b1b2b3b4b5b6b788ac', bps: 300 },
  ],
  version: '1',
  issuerId: 'yearsend_foundry',
};

const demoPolicyH: TicketPolicy = {
  resaleAllowed: true,
  royaltyBps: 1200,
  royaltyRecipients: [
    { id: 'curator', lockingScriptHex: '76a914c1c2c3c4c5c6c7c8c9cacbcccdcecfd0d1d288ac', bps: 6000 },
    { id: 'venue', lockingScriptHex: '76a914d3d4d5d6d7d8d9dadbdcdddedf000102030488ac', bps: 2500 },
    { id: 'protocol', lockingScriptHex: '76a9140405060708090a0b0c0d0e0f101112131488ac', bps: 1500 },
  ],
  primaryRecipients: [
    { id: 'organizer', lockingScriptHex: '76a9141415161718191a1b1c1d1e1f202122232488ac', bps: 4200 },
    { id: 'venue', lockingScriptHex: '76a9142425262728292a2b2c2d2e2f303132333488ac', bps: 3000 },
    { id: 'artist', lockingScriptHex: '76a9143435363738393a3b3c3d3e3f404142434488ac', bps: 2000 },
    { id: 'production', lockingScriptHex: '76a9144445464748494a4b4c4d4e4f505152535488ac', bps: 800 },
  ],
  version: '1',
  issuerId: 'solar_collective',
};

export const defaultEvents: EventRecord[] = [
  buildEventRecord({
    eventId: 'evt_1234567890abcdef',
    name: 'Bitcoin Conference 2025',
    venue: 'Convention Center',
    startsAtISO: '2025-03-15T09:00:00Z',
    endsAtISO: '2025-03-15T18:00:00Z',
    capacity: 500,
    priceSats: 50000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: true,
    sold: 342,
    redeemed: 89,
    revenueSats: 17100000,
    policy: demoPolicyA,
    issuerSignatureSeed: 'template',
    imageUrl: 'https://images.unsplash.com/photo-1521572267360-ee0c2909d518?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_0987654321fedcba',
    name: 'Lightning Workshop',
    venue: 'Tech Hub',
    startsAtISO: '2025-02-10T14:00:00Z',
    endsAtISO: '2025-02-10T17:00:00Z',
    capacity: 100,
    priceSats: 25000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: false,
    sold: 100,
    redeemed: 100,
    revenueSats: 2500000,
    policy: demoPolicyB,
    issuerSignatureSeed: 'template',
    imageUrl: 'https://images.unsplash.com/photo-1521737604893-d14cc237f11d?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_cryptopunk2026',
    name: 'CRYPTO PUNK FESTIVAL 2026',
    venue: 'Neon Dome',
    startsAtISO: '2026-03-15T18:00:00Z',
    endsAtISO: '2026-03-16T02:00:00Z',
    capacity: 1200,
    priceSats: 50000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: true,
    sold: 860,
    redeemed: 410,
    revenueSats: 43000000,
    policy: demoPolicyC,
    issuerSignatureSeed: 'tix_cryptopunk',
    imageUrl: 'https://images.unsplash.com/photo-1521572267360-ee0c2909d518?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_neotokyo',
    name: 'NEO-TOKYO NIGHT MARKET',
    venue: 'Shinjuku Interchange',
    startsAtISO: '2026-03-25T19:00:00Z',
    endsAtISO: '2026-03-26T01:00:00Z',
    capacity: 800,
    priceSats: 125000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: true,
    sold: 640,
    redeemed: 120,
    revenueSats: 80000000,
    policy: demoPolicyC,
    issuerSignatureSeed: 'tix_neotokyo',
    imageUrl: 'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_midnight_garden',
    name: 'MIDNIGHT GARDEN ASSEMBLY',
    venue: 'Solarium Pavilion',
    startsAtISO: '2026-04-08T20:00:00Z',
    endsAtISO: '2026-04-09T03:00:00Z',
    capacity: 950,
    priceSats: 68000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: true,
    sold: 312,
    redeemed: 0,
    revenueSats: 21216000,
    policy: demoPolicyD,
    issuerSignatureSeed: 'tix_midnight',
    imageUrl: 'https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_satellite_sessions',
    name: 'SATELLITE SESSIONS VOL. 7',
    venue: 'Orbital Ridge Warehouse',
    startsAtISO: '2025-11-12T21:00:00Z',
    endsAtISO: '2025-11-13T04:00:00Z',
    capacity: 750,
    priceSats: 42000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: true,
    sold: 480,
    redeemed: 0,
    revenueSats: 20160000,
    policy: demoPolicyE,
    issuerSignatureSeed: 'sat_sessions',
    imageUrl: 'https://images.unsplash.com/photo-1514525253161-7a46d19cd819?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_bazaar_block',
    name: 'BAZAAR BLOCK POP-UP',
    venue: 'Old Exchange Courtyard',
    startsAtISO: '2025-09-20T10:00:00Z',
    endsAtISO: '2025-09-20T22:00:00Z',
    capacity: 600,
    priceSats: 18000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: false,
    sold: 600,
    redeemed: 580,
    revenueSats: 10800000,
    policy: demoPolicyF,
    issuerSignatureSeed: 'bazaar_block',
    imageUrl: 'https://images.unsplash.com/photo-1472653816316-3ad6f10a6592?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_fjord_jazz',
    name: 'FJORD JAZZ IMMERSION',
    venue: 'Nordic Glasshouse',
    startsAtISO: '2025-12-05T18:30:00Z',
    endsAtISO: '2025-12-05T23:30:00Z',
    capacity: 420,
    priceSats: 36000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: true,
    sold: 210,
    redeemed: 0,
    revenueSats: 7560000,
    policy: demoPolicyE,
    issuerSignatureSeed: 'fjord_jazz',
    imageUrl: 'https://images.unsplash.com/photo-1529158062015-cad636e69505?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_solar_synthesis',
    name: 'SOLAR SYNTHESIS SUMMIT',
    venue: 'Helios Innovation Park',
    startsAtISO: '2026-02-14T09:00:00Z',
    endsAtISO: '2026-02-14T19:00:00Z',
    capacity: 1100,
    priceSats: 52000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: true,
    sold: 560,
    redeemed: 0,
    revenueSats: 29120000,
    policy: demoPolicyH,
    issuerSignatureSeed: 'solar_summit',
    imageUrl: 'https://images.unsplash.com/photo-1489515217757-5fd1be406fef?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_hinterland_retreat',
    name: 'HINTERLAND BUILDER RETREAT',
    venue: 'Whispering Pines Lodge',
    startsAtISO: '2025-08-14T08:00:00Z',
    endsAtISO: '2025-08-16T17:00:00Z',
    capacity: 280,
    priceSats: 84000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: false,
    sold: 280,
    redeemed: 275,
    revenueSats: 23520000,
    policy: demoPolicyG,
    issuerSignatureSeed: 'hinterland_retreat',
    imageUrl: 'https://images.unsplash.com/photo-1499696010181-30e66f7d2d4d?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_arcade_sprint',
    name: 'ARCADE SPRINT HACKATHON',
    venue: 'Level-Up Dev Dojo',
    startsAtISO: '2025-10-24T18:00:00Z',
    endsAtISO: '2025-10-26T18:00:00Z',
    capacity: 480,
    priceSats: 21000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: true,
    sold: 320,
    redeemed: 0,
    revenueSats: 6720000,
    policy: demoPolicyG,
    issuerSignatureSeed: 'arcade_sprint',
    imageUrl: 'https://images.unsplash.com/photo-1526498460520-4c246339dccb?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_monolith_forum',
    name: 'MONOLITH FORUM 2025',
    venue: 'Granite Convention Spire',
    startsAtISO: '2025-05-04T09:30:00Z',
    endsAtISO: '2025-05-05T17:00:00Z',
    capacity: 1600,
    priceSats: 39000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: false,
    sold: 1530,
    redeemed: 1530,
    revenueSats: 59670000,
    policy: demoPolicyH,
    issuerSignatureSeed: 'monolith_forum',
    imageUrl: 'https://images.unsplash.com/photo-1498050108023-c5249f4df085?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_echoes_of_orbit',
    name: 'ECHOES OF ORBIT LIVE',
    venue: 'Lagrange Amphitheater',
    startsAtISO: '2026-01-22T19:30:00Z',
    endsAtISO: '2026-01-22T23:30:00Z',
    capacity: 540,
    priceSats: 47000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: true,
    sold: 390,
    redeemed: 0,
    revenueSats: 18330000,
    policy: demoPolicyE,
    issuerSignatureSeed: 'echoes_orbit',
    imageUrl: 'https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_cascadia_meetup',
    name: 'CASCADIA NODE MEETUP',
    venue: 'Rainshadow Hub',
    startsAtISO: '2025-07-02T17:00:00Z',
    endsAtISO: '2025-07-02T21:00:00Z',
    capacity: 260,
    priceSats: 9000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: false,
    sold: 240,
    redeemed: 200,
    revenueSats: 2160000,
    policy: demoPolicyF,
    issuerSignatureSeed: 'cascadia_node',
    imageUrl: 'https://images.unsplash.com/photo-1500534623283-312aade485b7?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_tidal_works',
    name: 'TIDAL WORKS RESIDENCY',
    venue: 'Portside Creative Labs',
    startsAtISO: '2026-03-02T10:00:00Z',
    endsAtISO: '2026-03-06T18:00:00Z',
    capacity: 120,
    priceSats: 104000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: true,
    sold: 48,
    redeemed: 0,
    revenueSats: 4992000,
    policy: demoPolicyG,
    issuerSignatureSeed: 'tidal_works',
    imageUrl: 'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_nightshift_gallery',
    name: 'NIGHTSHIFT GALLERY CYCLE',
    venue: 'Chromium Annex',
    startsAtISO: '2025-06-11T19:00:00Z',
    endsAtISO: '2025-06-11T23:00:00Z',
    capacity: 320,
    priceSats: 24000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: false,
    sold: 300,
    redeemed: 295,
    revenueSats: 7200000,
    policy: demoPolicyE,
    issuerSignatureSeed: 'nightshift_cycle',
    imageUrl: 'https://images.unsplash.com/photo-1520898681921-5f1c17004d60?auto=format&fit=crop&w=1200&q=80',
  }),
  buildEventRecord({
    eventId: 'evt_lumen_afterglow',
    name: 'LUMEN AFTERGLOW',
    venue: 'Aurora Atrium',
    startsAtISO: '2025-04-18T22:00:00Z',
    endsAtISO: '2025-04-19T05:00:00Z',
    capacity: 900,
    priceSats: 46000,
    protocolAddr: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    venueSink: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh',
    salesOpen: false,
    sold: 870,
    redeemed: 860,
    revenueSats: 40200000,
    policy: demoPolicyH,
    issuerSignatureSeed: 'lumen_afterglow',
    imageUrl: 'https://images.unsplash.com/photo-1489515217757-5fd1be406fef?auto=format&fit=crop&w=1200&q=80',
  }),
];

export const getEventById = (events: EventRecord[], eventId: string) => {
  return events.find((event) => event.eventId === eventId);
};
